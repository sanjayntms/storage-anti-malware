# Downloads ClamAV Docker image source from GitHub and places a specific version to "clamav-container" folder

$DockerClamAVProjectName = "docker-clamav"
$Branch = "master"
$DockerClamAVUrl = "https://github.com/mko-x/$DockerClamAVProjectName/archive/$Branch.zip"
$PackageFile = Join-Path $PSScriptRoot "DockerClamAV.zip"

$AlpineMainPath = Join-Path $PSScriptRoot -ChildPath "$DockerClamAVProjectName-$Branch" `
    | Join-Path -ChildPath "alpine" `
    | Join-Path -ChildPath "main" `
    | Join-Path -ChildPath "*"

$DockerFileDestinationFolderName = "clamav-container"

Write-Output "Downloading ClamAV daemon as a Docker image by Markus Kosmal (https://github.com/mko-x)"
Write-Output "  * From: $DockerClamAVUrl"
Write-Output "  * MIT License: https://github.com/mko-x/$DockerClamAVProjectName/blob/$Branch/LICENSE"
(New-Object System.Net.WebClient).DownloadFile($DockerClamAVUrl, $PackageFile)

Write-Output "Expanding archive"
Expand-Archive -Path $PackageFile -DestinationPath $PSScriptRoot -Force

Write-Output "Copying Alpine/main folder to $DockerFileDestinationFolderName"
New-Item -Path $PSScriptRoot -Name $DockerFileDestinationFolderName -ItemType "directory" -Force
$DockerFileDestinationFolder = Join-Path $PSScriptRoot $DockerFileDestinationFolderName
Copy-Item -Path $AlpineMainPath -Destination $DockerFileDestinationFolder -Recurse -Force
