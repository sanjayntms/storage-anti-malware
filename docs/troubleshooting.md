# Troubleshooting

## Key Vault

### Deployment failure

**Error message:**

```plaintext
##[error]MissingSubscriptionRegistration: The subscription is not registered to use namespace 'Microsoft.KeyVault'.
```

**Solution:**

Option 1: Using Azure PowerShell, type command:

```powershell
Register-AzureRmResourceProvider -ProviderNamespace Microsoft.KeyVault
```

Option 2: In Azure Portal:

1. Navigate to Subscriptions
1. Select the corresponding subscription
1. On the left-hand pane, under **Settings**, select **Resource providers**
1. Find `Microsoft.KeyVault` and click **Register**
    ![Registering Key Vault service provider](./images/registering-key-vault-service-provider.png)

### Retrieving secrets fails

**Error message:**

```plaintext
"The policy requires the caller 'appid=***;oid=...;iss=https://sts.windows.net/***/' to use on-behalf-of (OBO) flow.
```

**Solution:**

Verify the steps in [Configure Key Vault](./deploying-with-azdo.md#configure-key-vault) section of the deployment guide were executed successfully.

## Quickstart script hangs

Using a proxy may cause `az ad user list` command to hang indefinitely haulting the quickstart script in the very beginning. Disconnect the proxy or resolve your user object ID (Azure Active Directory **Users** in Azure Portal) and fix the value in the script:

From this:

```ps1
$UserObjectId = (az ad user list | ConvertFrom-Json)[0].objectId
```

To something like this:

```ps1
$UserObjectId = "46427a8a-7f0d-45b1-90e4-234e655eb740"
```

where the GUID value is your Azure user object ID.
